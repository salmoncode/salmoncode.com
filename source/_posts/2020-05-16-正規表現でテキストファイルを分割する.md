---
title: 正規表現でテキストファイルを分割する
date: 2020-05-16 14:27:40
tags:
---

## はじめに

過去ブログのデータを移行しようとエクスポートしたら、1つのMTファイルとして出力されてしまいました。
仕方ないので、いい感じにファイルを分割したいと思ったのですがコードを書くのは面倒です…

そこで調べてみたところ、`csplit`というコマンドで正規表現による分割ができるようですね。
ちょっと使い方に癖があったのでメモしておきます。

<!-- more -->

## csplitコマンドの使い方

まず、**MacのcsplitコマンドはLinuxのそれと仕様が違います。**
ググって出てきた使い方だとうまく動かないという罠がありますw

なので、まずはgnu版をインストールしましょう。

```
brew install coreutils
```

基本的なコマンドは以下の通りです。

```
gcsplit <fileName> <pattern> [counter]
```

例えば以下のような`sample.txt`があったとします。

```
aaa
bbb
ccc
aaa
bbb
ccc
```

ここで以下のコマンドを打つと、

```
gcsplit sample.txt /bbb/
```

こうなります

ファイル1

```
aaa
```

ファイル2

```
bbb
ccc
aaa
bbb
ccc
```

元ファイル5行目の`bbb`でも分割したい場合は`counter`を設定します。

```
gcsplit sample.txt /bbb/ {2}
```

するとこんな感じに
ファイル1

```
aaa
```

ファイル2

```
bbb
ccc
aaa
```

ファイル3

```
bbb
ccc
```

つまり、ヒットしたパターンの行の直前で分割されるようですね。
ちなみに、ヒットした行全て分割したい場合は以下のようにします。

```
gcsplit sample.txt /bbb/ {*}
```

シンプルに指定できてなかなか便利なコマンドですね。

こういったテキスト処理系は魔術にならない程度にコマンドを駆使して高速化しましょうw
