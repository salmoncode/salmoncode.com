---
title: ProcessingでHSLを扱う
date: 2014-12-18 12:09:05
category: プログラミング
tags: Processing
---

僕の所属する研究室では顔画像を処理する研究が行われている。顔画像処理をする際には通常の RGB 色空間で処理
するよりも HSL で処理したほうが便利なことがある（顔検出とか）。
Processing では<a href="https://www.processing.org/reference/colorMode_.html">colorMode()</a>を使うことで RGB や HSB を簡単に扱うことができるが、HSL の扱い方が見つからない。そこで RGB->HSL に変換するメソッドを自作してみた。

<!-- more -->

## RGB とは

念のため、そもそも RGB とは何かを説明しておきたい。簡単に言えば、赤(Red)、緑(Green)、青(Blue)の混ざり具合のことで、この 3 原色を用いることでほぼどんな色でも表すことができる。中学の美術の教科書で色のついた円が 3 つ重なった画像を見かけたと思うがあれのことである。「加法混色」なので、混ざると白に近づき、真っ白は(255,255,255)で真っ黒は(0,0,0)である。

Processing ではデフォルトでこの RGB にアルファ値(A)を加えた RGBA を扱うことができる。
アルファ値とは透過度のことである。png などの画像を読み込むときに、その画像のアルファ値を部分的に 0 にすることで背景を消したりすることができる。

## HSB とは

こちらは、色相(Hue)、彩度(Saturation)、明度(Value・Lightness・Brightness)で表される色空間で、
僕は RGB で色をランダムに生成したときに汚い色ばかり出てきていやだな～と思ってドキュメントを読んだら見つけた。

明度が V だったり L だったりして、HSB,や HSL と呼ばれたりもする。つまり本質的には後述の HSL と同じなのだが、僕が期待する HSL 空間が錐体型のモデルなのに対し、Processing の HSB 空間はどうやら円柱型のようなのである。
そのため、この記事ではあえて明示的に HSB と HSL を分けて書いている。

## HSL とは

上記の通り、HSB と同じである。ちなみに、Wikipedia で調べるとまとめて HSV に転送される。この辺の議論はネットで調べるといろんな情報が（色だけに）でてくるのであまり深く突っ込まないことにする。

## RGB->HSL のメソッド

ここからが本題で、「Processing で扱われている RGB を錐体型の HSL に変換する」のが目的である。
以下がプログラムの全文である。

<script src="https://gist.github.com/salmon2073/d0aaa0373cb3f05fc7f5.js"></script>

3 つ値を返したかったので PVector を使ったが、もっといい方法があるかもしれない。入力は RGB で、H は 0~360, S,B は 0~100 の値で返ってくる。入力が float 型になってるのは random で数値を代入するときにいちいち int 型に直すのが面倒だったからで、リアルタイム処理などで速度を気にする場合は int で動くようにしたほうがいいかもしれない。

たまっていた Processing ネタをちょっとずつ消化しているが、そろそろ他のことも書きたい。
